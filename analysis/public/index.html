<!doctype>
<html>
    <head>
        <script src="/vendor/d3.min.js"></script>
        <script src="/vendor/mqtt.js"></script>
        <script src="/vendor/rickshaw/rickshaw.min.js"></script>
        <script src="/js/jquery.min.js"></script>
        <script src="/js/jquery-ui.min.js"></script>
        <script src="/js/graph.js"></script>

        <link rel="stylesheet" href="/vendor/rickshaw/rickshaw.min.css" />
        <link rel="stylesheet" href="/css/jquery-ui.min.css" />

		<style>
			#chart_container {
				position: relative;
				font-family: Arial, Helvetica, sans-serif;
                display: inline-block;
			}
			#chart {
				position: relative;
				left: 2rem;
                top: 1rem;
			}
			#y_axis_alt {
				position: absolute;
				top: 0;
				bottom: 0;
				width: 2rem;
			}
			#y_axis_acc {
				position: absolute;
				top: 0;
				bottom: 0;
                left: calc(1000px + 2rem);
                width: 2rem;
			}
			#y_axis_gyr {
                display: none;
				position: absolute;
				top: 0;
				bottom: 0;
                left: calc(1000px + 2rem + 2rem);
                width: 2rem;
			}

            #legend {
                display: inline-block;
                vertical-align: top;
                margin: 0 0 0 6rem;
            }
            #config {
                margin-top: 2rem;
            }
		</style>
    </head>
    <body>

		<div id="chart_container">
            <div id="y_axis_alt">Alt</div>
            <div id="chart"></div>
            <div id="y_axis_acc">Acc</div>
            <div id="y_axis_gyr">Gyr</div>
        </div>
        <div id="legend"></div>
        <div id="slider"></div>

        <div id="config">
            <div><input type="text" placeholder="MQTT Server eg iot.eclipse.org"/></div>
            <div><input type="text" placeholder="myid/rocket_surgery"></div>
            <button id="start">Start</button>
            <button id="pause">Pause / Stop</button>
            <button id="download">Download data</button>
        </div>

        <script>

            let grapher = new Grapher();

            let client = mqtt.connect("ws://iot.eclipse.org/ws");
            client.subscribe("rocket_surgery/data");

            client.on("connected", () => {
                console.log("Connected");
            });

            client.on("message", (topic, payload) => {
                let data = JSON.parse(payload.toString());
                //console.log(topic, payload.toString());

                grapher.add_data(data);

            });

        </script>

    </body>
</html>
